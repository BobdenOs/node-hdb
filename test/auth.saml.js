// Copyright 2013 SAP AG.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http: //www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an 
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
// either express or implied. See the License for the specific 
// language governing permissions and limitations under the License.
'use strict';

var lib = require('./lib');
var PartKind = lib.common.PartKind;
var Fields = lib.data[PartKind.AUTHENTICATION];

describe('Authentication', function () {

  describe('#SAML', function () {
    var part = {
      argumentCount: 1,
      buffer: new Buffer(
        '0700000453414d4cf6ef0b3c3f786d6c2076657273696f6e3d22312e30223f3e0a3c73' +
        '616d6c3a417373657274696f6e20786d6c6e733a73616d6c3d2275726e3a6f61736973' +
        '3a6e616d65733a74633a53414d4c3a322e303a617373657274696f6e2220786d6c6e73' +
        '3a78733d22687474703a2f2f7777772e77332e6f72672f323030312f584d4c53636865' +
        '6d612220786d6c6e733a7873693d22687474703a2f2f7777772e77332e6f72672f3230' +
        '30312f584d4c536368656d612d696e7374616e6365222049443d226230376238303463' +
        '2d376332392d656131362d373330302d34663364366637393238616322205665727369' +
        '6f6e3d22322e3022204973737565496e7374616e743d22323030342d31322d30355430' +
        '393a32323a30355a223e0a093c73616d6c3a4973737565723e68747470733a2f2f6964' +
        '702e6578616d706c652e6f72672f53414d4c3c2f73616d6c3a4973737565723e0a093c' +
        '5369676e617475726520786d6c6e733d22687474703a2f2f7777772e77332e6f72672f' +
        '323030302f30392f786d6c6473696723223e0a09093c5369676e6564496e666f3e0a09' +
        '09093c43616e6f6e6963616c697a6174696f6e4d6574686f6420416c676f726974686d' +
        '3d22687474703a2f2f7777772e77332e6f72672f54522f323030312f5245432d786d6c' +
        '2d6331346e2d3230303130333135222f3e0a0909093c5369676e61747572654d657468' +
        '6f6420416c676f726974686d3d22687474703a2f2f7777772e77332e6f72672f323030' +
        '302f30392f786d6c64736967237273612d73686131222f3e0a0909093c526566657265' +
        '6e6365205552493d22223e0a090909093c5472616e73666f726d733e0a09090909093c' +
        '5472616e73666f726d20416c676f726974686d3d22687474703a2f2f7777772e77332e' +
        '6f72672f323030302f30392f786d6c6473696723656e76656c6f7065642d7369676e61' +
        '74757265222f3e0a090909093c2f5472616e73666f726d733e0a090909093c44696765' +
        '73744d6574686f6420416c676f726974686d3d22687474703a2f2f7777772e77332e6f' +
        '72672f323030302f30392f786d6c647369672373686131222f3e0a090909093c446967' +
        '65737456616c75653e37394e6f7279376756307057644747374f42636859686447456d' +
        '6b3d3c2f44696765737456616c75653e0a0909093c2f5265666572656e63653e0a0909' +
        '3c2f5369676e6564496e666f3e0a09093c5369676e617475726556616c75653e702f4e' +
        '7478517a68414974354c6b37524f734155543879446475727367454a596c6a536c5a74' +
        '334963796c4a67426b596d716333624d5a725867574d357647610a4c66633564797274' +
        '4264306c5666416957655536544a376c3363764334316b695a4c7a45486f704b6b5349' +
        '3639486c4e623073433576596c52476f593178714e0a7132704558553049702b385839' +
        '416c71556a5664736d41654d6635303147584b626337524d477551563832414554727a' +
        '6673377466347337544b56493863347a0a6358715364793057704f47544377634f5465' +
        '34593365634e667864342f6f4254775a7861505a484732436e4a4f756a4e4f366a6954' +
        '686b4c31326670354867310a5453777279476b592b70497735476b3957703672625852' +
        '7a4b3131456a4b45616a6b485a36434241663451336c63506558352b526f50374e7873' +
        '774e636a42740a4e61315853375643794f4d4c5a395447776d4c4733413d3d3c2f5369' +
        '676e617475726556616c75653e0a09093c4b6579496e666f3e0a0909093c5835303944' +
        '6174613e0a090909093c5835303943657274696669636174653e0a4d49494546544343' +
        '41763267417749424167494a414e565565655368644172674d41304743537147534962' +
        '3344514542425155414d486b78437a414a42674e560a42415954416b52464d52417744' +
        '67594456515149457764485a584a74595735354d524577447759445651514845776858' +
        '595778735a4739795a6a45504d4130470a4131554543684d4755304651494546484d52' +
        '4577447759445651514c45776854515641675345464f515445684d4238474131554541' +
        '784d5955304651494546480a49456842546b45675647567a644342536232393049454e' +
        '424d434158445445784d446b794d4441334e4451304d6c6f59447a49794f4455774e7a' +
        '41314d4463300a4e445179576a42384d517377435159445651514745774a4552544551' +
        '4d4134474131554543424d485232567962574675655445524d4138474131554542784d' +
        '490a5632467362475276636d5978447a414e42674e5642416f54426c4e425543424252' +
        '7a45524d4138474131554543784d495530465149456842546b45784a4441690a42674e' +
        '5642414d5447314e4255434242527942495155354249464e54544331555a584e304c56' +
        '4e6c636e5a6c636a4343415349774451594a4b6f5a496876634e0a4151454242514144' +
        '676745504144434341516f4367674542414d6b5570665969456d783639485932763263' +
        '395463305577516137524b4d6e72324950444857500a4346394b4f3931476637467248' +
        '6e755648394b6d4b6d464a6f6259424f4364547957507434326d657533324a506c7556' +
        '4a69704c6c564b7674636b4b6e6a41630a7a71483268446a634b79636b795a56704e57' +
        '6f7379796a692b316f432f55364761446e2b5679634e772b70767a4b352f55354e5a56' +
        '4f2f327255696b506451320a6b2f46433376735857796a4a644a5967486b6346455774' +
        '7a696545696a337157365a6d474c2b64746d4f465446654a496c5a614f586751444558' +
        '6351796744440a30792b6130366b695066314971564230734a6d374539537243713351' +
        '4a61375a6e576b654850575937336d6e714b54664e745a7557634c4150726968757048' +
        '490a793132367662506633496f73504951324b615a6c475848417a4a3541416451684c' +
        '6b4f57554754424c36554e535a6b434177454141614f426d6a43426c7a414a0a42674e' +
        '5648524d45416a41414d43774743574347534147472b45494244515166466831506347' +
        '567555314e4d4945646c626d56795958526c5a4342445a584a300a61575a7059324630' +
        '5a54416442674e56485134454667515563456461665162744f65714a77677574477a2b' +
        '49652f3379584b6777487759445652306a424267770a466f41555a4f3032756a423777' +
        '7657322b476d4d734641796441416e6258737748415944565230524242557745344952' +
        '6447567a644335335a475975633246770a4c6d4e76636e41774451594a4b6f5a496876' +
        '634e415145464251414467674542414144786e2f5a73516b662b71645a587335794c6f' +
        '53784e52674c4a535571370a7630796a783552326d76327a4a55384c35556b71304965' +
        '6536486c56354269745963547944366d7878542f6a4a753453707276443337742f4566' +
        '506b77764b300a4a6d4656315365436e2f54326c4743645a684d444554444b796b7943' +
        '676555593933797856593351444c65694853326f7a7978644c6d43673079543470326a' +
        '6a0a312f694b53344331444b523261636d3474506337774b44547a6f715a504c527947' +
        '67394630585533754233704565704349383747544f576c624e45394b6b51410a335a4d' +
        '766441596a66584e6b3142624c4a4f514c66486d74737a65614e423750484e70596f48' +
        '494f636c61336f75305662364135424457762f31334d5a5642360a5a6f4d7261624963' +
        '67764c527064722b6e42355a3743756571764647353644646132647642626f35395466' +
        '477a3847555a4c41427634773d0a090909093c2f583530394365727469666963617465' +
        '3e0a0909093c2f58353039446174613e0a09093c2f4b6579496e666f3e0a093c2f5369' +
        '676e61747572653e0a093c73616d6c3a5375626a6563743e0a09093c73616d6c3a4e61' +
        '6d65494420466f726d61743d2275726e3a6f617369733a6e616d65733a74633a53414d' +
        '4c3a312e313a6e616d6569642d666f726d61743a756e737065636966696564223e0a09' +
        '090945585445524e414c5f555345525f4e414d450a09093c2f73616d6c3a4e616d6549' +
        '443e0a093c2f73616d6c3a5375626a6563743e0a093c73616d6c3a436f6e646974696f' +
        '6e73204e6f744265666f72653d22323031322d30312d30315430303a30303a30305a22' +
        '204e6f744f6e4f7241667465723d22323035302d30312d30315430303a30303a30305a' +
        '222f3e0a3c2f73616d6c3a417373657274696f6e3e0b534352414d5348413235364010' +
        '4052e1cf434b6515edccf85d567c59f0f9cc29ac22b820d5c7efa02cf2cbaac7c5db36' +
        '5df134f7e50b468cca88638290ee52e082d034e08f7b9e980517c1b108534352414d4d' +
        '4435400ee83e00c262492afb3fe662ead8b0f2dbed0c3181080a975bc7bf83ab698f7f' +
        '7da072bb0cfe4d28829c1f151d50b260203a47bd67f73b42ec65b7426b26c82e',
        'hex')
    };

    it('should read an authentication request', function () {
      var fields = Fields.read(part);
      fields.should.have.length(7);
      var username = fields.shift();
      var methodname = fields.shift().toString('ascii');
      var data = fields.shift().toString('utf8');
      methodname.toString('ascii').should.equal('SAML');
      methodname = fields.shift().toString('ascii');
      data = fields.shift();
      methodname = fields.shift().toString('ascii');
      data = fields.shift();
    });


  });

});